# Vue 中 Key 的作用

## 1. key 的含义

- `key` 是虚拟 DOM（VNode）的 **唯一标识**。
- 作用：在 **Diff 算法**（新旧虚拟 DOM 对比）中帮助 Vue 判断某个节点是否可以复用。
- 没有 key 时，Vue 默认会用 **“就地复用”** 策略：只要标签类型相同，就地修改内容。

## 2. key 的作用（浅 → 深）

- **保持元素身份一致性**
  比如表单输入，如果列表重新渲染时复用了错误的 DOM 节点，就会导致输入框错位。
  `key` 保证 “这个 DOM 就是原来那个 DOM”。

- **提升 Diff 精度**
  有了 key，Diff 能直接通过 Map 查找新旧节点对应关系，减少无意义的替换。

- **影响性能和正确性**

  - 正确性：解决复用错乱问题。
  - 性能：合理使用 key 可以减少 DOM 新建/删除。

## 3. 数组 push 的场景

假设：

```js
items = [1, 2, 3];
items.push(4);
```

### Vue 的处理逻辑：

- **Vue2**：使用 **双端比较算法**。
  新旧数组前后对比，前 3 项都能一一复用（因为 key 一样），最后新增的 `4` 会新建。
  👉 前 3 个节点会被 **直接复用缓存**，DOM 不动。

- **Vue3**：用更高效的 **最长递增子序列 (LIS) 算法**。
  同样会发现 `[1,2,3]` 没变，直接复用，最后 append 一个新节点。
  👉 旧数组值完全复用，只有新节点创建。

## 4. 如果没有 key 呢？

- Vue2：默认按顺序复用 DOM，push 新元素时也能工作，但如果你在数组中间插入，会出现复用错乱（输入框数据跑到别的项）。
- Vue3：如果你没写 key，Vue 会发警告，推荐显式 key，因为 Diff 算法强依赖唯一 key 来保证正确性。

✅ **总结一句话**：
在 Vue2/3 中，`key` 是 VNode 的唯一标识，确保 Diff 算法能正确、稳定、最小代价地复用 DOM。
对于数组 push 的场景，旧数组对应的 DOM 节点会直接复用缓存，只有新增元素会创建新的 DOM。
