# eggjs

## 洋葱模型

洋葱模型是 Node.js（包括 Egg.js）中间件的核心执行机制，形象理解就像 "剥洋葱"：

中间件执行时，先 "从外到内" 进入每一层（执行中间件的前半部分逻辑）；
当执行到最内层后，再 "从内到外" 返回每一层（执行中间件的后半部分逻辑）。

举个例子：如果有 3 个中间件 A、B、C，执行顺序是：
A 的前半部分 → B 的前半部分 → C 的前半部分 → C 的后半部分 → B 的后半部分 → A 的后半部分

这种机制的核心是 next()函数：调用 next()会进入下一个中间件，当所有内层中间件执行完后，代码会回到 next()之后，继续执行当前中间件的剩余逻辑。
