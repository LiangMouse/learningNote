# HTTP 版本迭代升级

HTTP 的发展经历了从简单到复杂、从“文本 + 单路串行”到“二进制 + 多路复用”，再到基于 QUIC 的传输层革新。下面按版本梳理关键差异与演进动机。

## HTTP/0.9 与 HTTP/1.0（背景）

- 0.9：仅支持 GET，纯文本，单次连接单次请求，响应无头部，功能极简；
- 1.0：引入状态码/头部/多方法，但默认短连接（每个请求一个 TCP），可选 Keep-Alive（非默认），弱缓存与内容协商能力初显。

## HTTP/1.1

优势（代表性特性）

1. 默认持久连接 Keep-Alive，复用同一 TCP 以减少握手开销；
2. 管线化（Pipelining）概念提出；
3. 分块传输（Chunked Transfer）、范围请求（Range）、缓存控制（Cache-Control/ETag）、内容协商、Host 头（虚拟主机）等完善；

劣势/局限

1. 应用层队头阻塞（HoL）：同一连接内响应必须按顺序返回，慢响应会阻塞后续；
2. 浏览器为规避 HoL 往往并行开多连接（每域名 6 ～ 8 个），增加拥塞与竞争；
3. Pipelining 受中间设备兼容性差等问题，实际很少启用。

## HTTP/2.0

1. 二进制分帧：将请求/响应拆分为帧，独立的流（stream）在同一 TCP 上并行传输；
2. 多路复用：消除 HTTP/1.1 的应用层 HoL（但仍存在 TCP 层包丢失引起的连接级阻塞）；
3. HPACK 首部压缩：静态表/动态表 + Huffman 编码，显著降低头部开销；
4. 流优先级/依赖：可提示调度优先顺序（实际落地效果依实现与丢包状况而异）；
5. 服务器推送（Server Push）：可提前推送资源（现已在多数浏览器中被弃用或不再推荐，建议以 Preload 为主）。

## HTTP/3.0（基于 QUIC）

1. 传输层改用 QUIC（基于 UDP）：内建多路复用与拥塞控制，避免 TCP 连接级 HoL；
2. 0-RTT/TLS 1.3：握手更少往返，迁移连接更快；
3. 连接迁移：基于 Connection ID，IP/网络切换时无需重建连接；
4. QPACK 头部压缩：解决 H2 下动态表与流竞争导致的队首阻塞问题；
5. 更好的中断/丢包表现：单流丢包不影响其他流。

## 对比总览（要点）

| 版本      | HTTP/1.1                   | HTTP/2                          | HTTP/3（QUIC）                    |
| --------- | -------------------------- | ------------------------------- | --------------------------------- |
| 表达方式  | 文本                       | 二进制分帧                      | 二进制分帧                        |
| 复用      | 连接内串行（常多连接并行） | 单连接多路复用                  | 单连接多路复用                    |
| 头部压缩  | 无/弱                      | HPACK                           | QPACK                             |
| 队头阻塞  | 应用层 HoL                 | 无应用层 HoL（仍有 TCP 级 HoL） | 消除连接级 HoL                    |
| 传输/安全 | TCP + 可选 TLS             | TCP + TLS（ALPN）               | QUIC（UDP）+ TLS 1.3（内建）      |
| 其它特性  | —                          | 优先级/依赖、服务器主动推送     | 0-RTT、连接迁移、丢包隔离（按流） |
