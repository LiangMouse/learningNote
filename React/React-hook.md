# React-hook

**hook ç®€ä»‹**: å‡½æ•°ç»„ä»¶ ç”Ÿå‘½å‘¨æœŸ ä¾èµ–æ•°ç»„ å›è°ƒå‡½æ•°

## hook åŸç†

**ä¸ºä»€ä¹ˆ hook ä¸èƒ½è¢«æ¡ä»¶æ‰§è¡Œï¼Ÿ**

#### ä»æ—¥å¸¸ç”Ÿæ´»çš„ä¹¦æ¶è¯´èµ·

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªä¹¦æ¶ï¼Œæ¯ä¸ªä½ç½®éƒ½æœ‰ä¸€ä¸ªå›ºå®šçš„ç¼–å·ï¼ˆ1 å·ã€2 å·ã€3 å·...ï¼‰ã€‚æ¯æ¬¡ä½ å»å–ä¹¦ï¼Œä½ éƒ½æŒ‰ç…§è¿™ä¸ªå›ºå®šçš„é¡ºåºï¼šç¬¬ 1 ä¸ªä½ç½®æ€»æ˜¯æ”¾ã€ŠJavaScript é«˜çº§ç¨‹åºè®¾è®¡ã€‹ï¼Œç¬¬ 2 ä¸ªä½ç½®æ€»æ˜¯æ”¾ã€ŠReact æŠ€æœ¯æ­ç§˜ã€‹ï¼Œç¬¬ 3 ä¸ªä½ç½®æ€»æ˜¯æ”¾ã€Šç®—æ³•å¯¼è®ºã€‹ã€‚

çªç„¶æœ‰ä¸€å¤©ï¼Œä½ å†³å®šï¼š**å¦‚æœä»Šå¤©æ˜¯å‘¨ä¸€ï¼Œå°±è·³è¿‡ç¬¬ 2 ä¸ªä½ç½®ï¼Œç›´æ¥ä»ç¬¬ 1 ä¸ªè·³åˆ°ç¬¬ 3 ä¸ª**ã€‚ç»“æœä¼šæ€æ ·ï¼Ÿ

- å‘¨ä¸€ï¼šä½ æ‹¿åˆ°äº†ã€ŠJavaScriptã€‹å’Œã€Šç®—æ³•å¯¼è®ºã€‹ï¼Œä½†æ²¡æœ‰ã€ŠReactã€‹â€”â€”è¿˜ç®—æ­£å¸¸
- å‘¨äºŒï¼šä½ æŒ‰ç…§åŸé¡ºåºï¼Œå´å‘ç°åŸæœ¬åœ¨ 2 å·ä½ç½®çš„ã€ŠReactã€‹è·‘åˆ°äº† 3 å·ä½ç½®ï¼
- ä½ æ‹¿èµ· 3 å·ä½ç½®çš„ä¹¦ï¼Œä»¥ä¸ºæ˜¯ã€Šç®—æ³•å¯¼è®ºã€‹ï¼Œç»“æœå´æ˜¯ã€ŠReactã€‹â€”â€”**æ··ä¹±äº†ï¼**

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Hook ä¸èƒ½è¢«æ¡ä»¶æ‰§è¡Œçš„åŸå› ã€‚React çš„ Hook ç³»ç»Ÿå°±åƒä¸€ä¸ª"å›ºå®šç¼–å·çš„ä¹¦æ¶"ï¼Œæ¯ä¸ª Hook å¿…é¡»**å§‹ç»ˆåœ¨åŒä¸€ä¸ªä½ç½®ã€åŒä¸€ä¸ªé¡ºåº**è¢«è°ƒç”¨ã€‚

#### é”™è¯¯ç¤ºä¾‹ï¼šå½“æ¡ä»¶è®© Hook "æ¶ˆå¤±"æ—¶

```jsx
function MyComponent({ isLoggedIn }) {
  // âŒ é”™è¯¯ï¼šHook åœ¨æ¡ä»¶è¯­å¥ä¸­
  if (isLoggedIn) {
    const [user, setUser] = useState(null); // æœ‰æ—¶å€™è¿™ä¸ª Hook å­˜åœ¨
  }

  const [count, setCount] = useState(0); // æœ‰æ—¶å€™åœ¨ä½ç½®1ï¼Œæœ‰æ—¶å€™åœ¨ä½ç½®2

  // é—®é¢˜ï¼šå½“ isLoggedIn ä» true å˜æˆ falseï¼ŒHook çš„é¡ºåºå˜äº†ï¼
}
```

**ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ**

1. **ç¬¬ä¸€æ¬¡æ¸²æŸ“**ï¼ˆ`isLoggedIn = true`ï¼‰ï¼š

   - ä½ç½® 1ï¼š`useState(null)` â†’ åˆ›å»ºäº† `user` çŠ¶æ€
   - ä½ç½® 2ï¼š`useState(0)` â†’ åˆ›å»ºäº† `count` çŠ¶æ€

2. **ç¬¬äºŒæ¬¡æ¸²æŸ“**ï¼ˆ`isLoggedIn = false`ï¼‰ï¼š
   - ä½ç½® 1ï¼š`useState(0)` â†’ React ä»¥ä¸ºè¿™æ˜¯ `user`ï¼Œä½†å®é™…æ˜¯ `count`ï¼
   - **ç»“æœ**ï¼š`count` çš„å€¼è¢«è¯¯è®¤ä¸ºæ˜¯ `user`ï¼ŒçŠ¶æ€å®Œå…¨é”™ä¹±äº†ï¼

#### React å¦‚ä½•è¿½è¸ª Hookï¼šä¸€ä¸ªéšå½¢çš„é“¾è¡¨

React å†…éƒ¨ä½¿ç”¨ä¸€ä¸ª**é“¾è¡¨ï¼ˆLinkedListï¼‰**æ¥å­˜å‚¨æ¯ä¸ª Hook çš„çŠ¶æ€ã€‚è¿™ä¸ªé“¾è¡¨å°±åƒä¸€ä¸²ç å­ï¼Œæ¯ä¸ªç å­ä»£è¡¨ä¸€ä¸ª Hookï¼š

```
[useState] â†’ [useEffect] â†’ [useState] â†’ [useMemo] â†’ ...
  ç å­1        ç å­2         ç å­3        ç å­4
```

æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶ï¼ŒReact ä¼š**æŒ‰ç…§è°ƒç”¨é¡ºåº**éå†è¿™ä¸ªé“¾è¡¨ï¼š

```jsx
function Component() {
  // React åˆ›å»ºé“¾è¡¨ï¼šç å­1
  const [name, setName] = useState("");

  // React ç»§ç»­æ·»åŠ ï¼šç å­2
  useEffect(() => {}, []);

  // React ç»§ç»­æ·»åŠ ï¼šç å­3
  const [age, setAge] = useState(0);
}
```

React çš„éå†é€»è¾‘å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š

```javascript
// ä¼ªä»£ç ï¼šReact å†…éƒ¨çš„ Hook éå†é€»è¾‘
let currentHook = fiber.memoizedState; // é“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
let hookIndex = 0;

while (currentHook) {
  // æ ¹æ® hookIndex æ‰¾åˆ°å¯¹åº”çš„ Hook
  // å¦‚æœé¡ºåºå˜äº†ï¼Œå°±æ‰¾é”™äº†ï¼
  hookIndex++;
  currentHook = currentHook.next;
}
```

#### æ¡ä»¶æ‰§è¡Œå¦‚ä½•ç ´åè¿™ä¸ªç³»ç»Ÿ

å½“ Hook è¢«æ¡ä»¶æ‰§è¡Œæ—¶ï¼Œå°±åƒé“¾è¡¨ä¸­çš„æŸä¸ªç å­"æ¶ˆå¤±"äº†ï¼š

```jsx
// ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼šisVisible = true
function Component({ isVisible }) {
  const [a, setA] = useState(0); // é“¾è¡¨ä½ç½®1
  if (isVisible) {
    const [b, setB] = useState(0); // é“¾è¡¨ä½ç½®2
  }
  const [c, setC] = useState(0); // é“¾è¡¨ä½ç½®3
}

// ç¬¬äºŒæ¬¡æ¸²æŸ“ï¼šisVisible = false
function Component({ isVisible }) {
  const [a, setA] = useState(0); // React è®¤ä¸ºè¿™æ˜¯ä½ç½®1 âœ“
  // b çš„ Hook ä¸æ‰§è¡Œäº†ï¼Œä½† React ä»ç„¶ä¼šæŸ¥æ‰¾ä½ç½®2
  const [c, setC] = useState(0); // React ä»¥ä¸ºè¿™æ˜¯ä½ç½®2ï¼Œå®é™…åº”è¯¥æ˜¯ä½ç½®3ï¼
  // ç»“æœï¼šc çš„çŠ¶æ€å€¼è¢«è¯¯å­˜åˆ°äº† b çš„ä½ç½®
}
```

#### æ­£ç¡®åšæ³•ï¼šæ¡ä»¶é€»è¾‘æ”¾åœ¨ Hook å†…éƒ¨

```jsx
function MyComponent({ isLoggedIn }) {
  // âœ… æ­£ç¡®ï¼šHook å§‹ç»ˆåœ¨é¡¶å±‚
  const [user, setUser] = useState(null);
  const [count, setCount] = useState(0);

  // æ¡ä»¶é€»è¾‘æ”¾åœ¨ Hook çš„å‚æ•°æˆ–å†…éƒ¨
  useEffect(() => {
    if (isLoggedIn) {
      // åšä¸€äº›ç™»å½•ç›¸å…³çš„äº‹æƒ…
    }
  }, [isLoggedIn]);
}
```

æˆ–è€…ä½¿ç”¨**æ—©æœŸè¿”å›**ï¼Œä½†å¿…é¡»åœ¨æ‰€æœ‰ Hook ä¹‹åï¼š

```jsx
function MyComponent({ isLoggedIn }) {
  // âœ… æ­£ç¡®ï¼šæ‰€æœ‰ Hook éƒ½åœ¨é¡¶éƒ¨
  const [user, setUser] = useState(null);
  const [count, setCount] = useState(0);
  const data = useMemo(() => compute(), []);

  // æ¡ä»¶è¿”å›æ”¾åœ¨æ‰€æœ‰ Hook ä¹‹å
  if (!isLoggedIn) {
    return <div>è¯·ç™»å½•</div>;
  }

  return <div>...</div>;
}
```

#### æ·±å…¥æºç ï¼šFiber èŠ‚ç‚¹çš„ memoizedState

åœ¨ React Fiber æ¶æ„ä¸­ï¼Œæ¯ä¸ªå‡½æ•°ç»„ä»¶å¯¹åº”ä¸€ä¸ª Fiber èŠ‚ç‚¹ã€‚Hook çš„çŠ¶æ€å­˜å‚¨åœ¨ `Fiber.memoizedState` ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼š

```javascript
// React å†…éƒ¨ç»“æ„ï¼ˆç®€åŒ–ç‰ˆï¼‰
type Fiber = {
  memoizedState: Hook | null, // æŒ‡å‘ç¬¬ä¸€ä¸ª Hook çš„é“¾è¡¨å¤´
  // ...
};

type Hook = {
  memoizedState: any, // Hook çš„çŠ¶æ€å€¼
  next: Hook | null, // æŒ‡å‘ä¸‹ä¸€ä¸ª Hook
  // ...
};
```

å½“ä½ è°ƒç”¨ `useState(initialValue)` æ—¶ï¼ŒReact ä¼šï¼š

1. **é¦–æ¬¡æ¸²æŸ“**ï¼šåˆ›å»ºæ–°çš„ Hook èŠ‚ç‚¹ï¼ŒæŒ‚åˆ°é“¾è¡¨æœ«å°¾
2. **åç»­æ¸²æŸ“**ï¼šæŒ‰ç…§ `hookIndex` éå†é“¾è¡¨ï¼Œæ‰¾åˆ°å¯¹åº”çš„ Hookï¼Œå¤ç”¨çŠ¶æ€

å¦‚æœ Hook çš„è°ƒç”¨é¡ºåºå˜äº†ï¼Œ`hookIndex` å°±ä¼šé”™ä½ï¼Œå¯¼è‡´çŠ¶æ€é”™ä¹±ã€‚

#### æ€»ç»“

**ä¸ºä»€ä¹ˆ Hook ä¸èƒ½è¢«æ¡ä»¶æ‰§è¡Œï¼Ÿ**

1. **Hook ä¾èµ–å›ºå®šçš„è°ƒç”¨é¡ºåº**ï¼šReact ç”¨é“¾è¡¨æŒ‰é¡ºåºå­˜å‚¨æ¯ä¸ª Hook çš„çŠ¶æ€
2. **æ¡ä»¶æ‰§è¡Œä¼šæ”¹å˜é¡ºåº**ï¼šå¯¼è‡´ React åœ¨é”™è¯¯çš„é“¾è¡¨ä½ç½®æŸ¥æ‰¾æˆ–æ›´æ–°çŠ¶æ€
3. **ç»“æœæ˜¯çŠ¶æ€é”™ä¹±**ï¼šä¸åŒæ¸²æŸ“ä¹‹é—´ï¼ŒHook çš„çŠ¶æ€å€¼ä¼šè¢«"å¼ å† ææˆ´"

è®°ä½ï¼š**Hook å°±åƒä¹¦æ¶ä¸Šçš„ä¹¦ï¼Œä½ç½®å¿…é¡»å›ºå®šã€‚æ¡ä»¶é€»è¾‘å¯ä»¥æ§åˆ¶"è¯»ä¸è¯»è¿™æœ¬ä¹¦"ï¼Œä½†ä¸èƒ½æ§åˆ¶"è¿™æœ¬ä¹¦è¦ä¸è¦æ”¾åœ¨ä¹¦æ¶ä¸Š"ã€‚**

## å¸¸ç”¨ hook

### **useState**

çŠ¶æ€æ˜¯å˜åŒ–çš„æ•°æ®ï¼Œæ˜¯ç»„ä»¶ç”šè‡³å‰ç«¯åº”ç”¨çš„æ ¸å¿ƒã€‚useState æœ‰ä¼ å…¥å€¼å’Œå‡½æ•°ä¸¤ç§å‚æ•°ï¼Œè¿”å›çš„ setState ä¹Ÿæœ‰ä¼ å…¥å€¼å’Œä¼ å…¥å‡½æ•°ä¸¤ç§å‚æ•°ã€‚

#### ä»€ä¹ˆæ—¶å€™ä½¿ç”¨

åœ¨ React ä¸­ï¼Œå½“ä¸€ä¸ªç»„ä»¶çš„æŸä¸ªå€¼éœ€è¦åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­ä¿æŒä¸å˜ï¼Œå¹¶ä¸”å½“è¿™ä¸ªå€¼å‘ç”Ÿå˜åŒ–æ—¶éœ€è¦è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œå°±åº”è¯¥ä½¿ç”¨ `useState` é’©å­æ¥ç®¡ç†å®ƒã€‚

#### setState å‡½æ•°å¼æ›´æ–°

`React`å“²å­¦ä¸­è®²è¿°äº†ä»–æ˜¯ä¸€ä¸ªå€¡å¯¼å‡½æ•°å¼çš„åº“,æ•°æ®é©±åŠ¨ UI,çŠ¶æ€ä¸å˜è§†å›¾å°±ä¸å˜ã€‚ç›¸ä¼¼åœ°ï¼Œ`setState`ä¹Ÿæå€¡ä½¿ç”¨å‡½æ•°å¼æ›´æ–°ã€‚æ¯”å¦‚ä½ æ˜¯å¦æ¸…æ¥š`setNum(prev => prev +1)`å’Œ`setNum(num + 1)`çš„åŒºåˆ«ï¼Ÿä½œä¸ºç”Ÿäº§ä¸­å¸¸ç”¨åˆ°çš„ä¸œè¥¿ï¼Œé¢è¯•ä¸­å¸¸è€ƒçš„é—®é¢˜ï¼Œä¸€å®šè¦æ¸…æ¥šä¸¤è€…çš„åŒºåˆ«ã€‚ğŸ˜¤

ç›´æ¥ä¸‹**ç»“è®º** :
å½“å±æ€§çš„æ–°çŠ¶æ€ä¸ä¾èµ–æ—§çŠ¶æ€æ—¶ï¼Œç›´æ¥`setState(data)`ï¼Œå¦‚è·å–ç½‘ç»œè¯·æ±‚è¿”å›çš„ç»“æœã€‚

å½“å±æ€§çš„æ–°çŠ¶æ€ä¾èµ–æ—§çŠ¶æ€ï¼Œéœ€è¦å‡½æ•°å¼æ›´æ–°`setState(prev => prev+1)`,å¦‚è®¡æ•°å™¨ä»¥åŠå¼€å…³ã€‚

æºç ä¸­**åŸç†**:

#### `setState` å‡½æ•°å¼æ›´æ–°çš„ç²¾å¦™ä¹‹å¤„ï¼šæ–°æ—§çŠ¶æ€çš„"æ—¶ç©ºå·®"

ç›¸ä¿¡ä½ å’Œæˆ‘ä¸€æ ·ï¼Œåœ¨ React é¡¹ç›®ä¸­éƒ½ç¦»ä¸å¼€ `setState`ã€‚ä½†ä½ æ˜¯å¦æ¸…æ¥š `setNum(prev => prev + 1)` å’Œ `setNum(num + 1)` çš„åŒºåˆ«ï¼Ÿä½œä¸ºç”Ÿäº§ä¸­å¸¸ç”¨åˆ°çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬ä¸€å®šè¦æ¸…æ¥šä¸¤è€…çš„åŒºåˆ«ã€‚

ç›´æ¥ä¸‹**ç»“è®º**ï¼š

- å½“å±æ€§çš„æ–°çŠ¶æ€**ä¸ä¾èµ–æ—§çŠ¶æ€**æ—¶ï¼Œç›´æ¥ `setState(data)`ã€‚æ¯”å¦‚ä»ç½‘ç»œè¯·æ±‚è¿”å›çš„ç»“æœæ¥æ›´æ–°çŠ¶æ€ã€‚
- å½“å±æ€§çš„æ–°çŠ¶æ€**ä¾èµ–æ—§çŠ¶æ€**æ—¶ï¼Œéœ€è¦å‡½æ•°å¼æ›´æ–° `setState(prev => prev + 1)`ã€‚æ¯”å¦‚è®¡æ•°å™¨ä»¥åŠå¼€å…³çš„åˆ‡æ¢ã€‚

**æ·±å…¥åŸç†**ï¼šä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™ä¸ªåŒºåˆ«ï¼Ÿ

è¿™ä¸¤ç§å†™æ³•çš„æ ¹æœ¬å·®å¼‚ï¼Œæºäº React **æ›´æ–°é˜Ÿåˆ—**ä¸­çš„ä¸€ä¸ªå…³é”®â€œæ—¶ç©ºå·®â€é—®é¢˜ã€‚

1. ç›´æ¥ä¼ å…¥å±æ€§ï¼šè¢«â€œå®šæ ¼â€çš„æ—§å€¼

å½“ä½ è°ƒç”¨ `setState({ count: this.state.count + 1 })` æ—¶ï¼ŒReact å¹¶ä¸ä¼šç«‹åˆ»æ‰§è¡ŒçŠ¶æ€æ›´æ–°ã€‚ç”±äº `setState` çš„**å¼‚æ­¥**å’Œ**æ‰¹é‡**ç‰¹æ€§ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªæ›´æ–°è¯·æ±‚æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ã€‚

é—®é¢˜å°±å‡ºåœ¨è¿™é‡Œï¼šé˜Ÿåˆ—ä¸­å­˜æ”¾çš„æ˜¯ä¸€ä¸ªå·²ç»è®¡ç®—å¥½çš„**â€œå¿«ç…§â€**ã€‚

`this.state.count + 1` åœ¨ `setState` è¢«è°ƒç”¨çš„é‚£ä¸€åˆ»å°±**ç«‹å³**å®Œæˆäº†è®¡ç®—ã€‚å¦‚æœå½“æ—¶çš„ `count` æ˜¯ `0`ï¼Œé‚£ä¹ˆé˜Ÿåˆ—ä¸­ä¿å­˜çš„å°±æ˜¯ä¸€ä¸ªå†™æ­»çš„ `{ count: 1 }`ã€‚å¦‚æœè¿™æ—¶æœ‰å¦ä¸€ä¸ª `setState` ç´§éšå…¶åï¼Œå®ƒåŒæ ·ä¼šåŸºäºè¿‡æ—¶çš„ `count` (`0`) è®¡ç®—å‡º `1`ï¼Œå¹¶æŠŠ `{ count: 1 }` å­˜å…¥é˜Ÿåˆ—ã€‚

å½“ React æœ€ç»ˆå¤„ç†é˜Ÿåˆ—æ—¶ï¼Œå®ƒä¼šå–å‡ºè¿™ä¸¤ä¸ª `{ count: 1 }`ï¼Œå¯¼è‡´çŠ¶æ€ä» `0` æ›´æ–°åˆ° `1`ï¼Œç„¶ååˆåœç•™åœ¨ `1`ã€‚å› ä¸ºå®ƒè¢«**è¿‡æ—¶çš„çŠ¶æ€â€œå®šæ ¼â€**äº†ï¼Œæ ¹æœ¬ä¸çŸ¥é“åé¢è¿˜æœ‰å…¶ä»–æ›´æ–°ã€‚

2. å‡½æ•°å¼æ›´æ–°ï¼šåŠ¨æ€çš„é€»è¾‘æŒ‡ä»¤

è€Œå½“ä½ ä½¿ç”¨ `setState(prevState => ({ count: prevState.count + 1 }))` æ—¶ï¼Œä½ å­˜å…¥é˜Ÿåˆ—çš„ä¸æ˜¯ä¸€ä¸ªç»“æœï¼Œè€Œæ˜¯ä¸€æ¡**æŒ‡ä»¤**ï¼š**â€œæ‹¿åˆ°æœ€æ–°çš„ `count`ï¼Œç„¶åç»™å®ƒåŠ  `1`â€**ã€‚

è¿™æ¡æŒ‡ä»¤æ˜¯æ´»çš„ï¼Œå®ƒæ²¡æœ‰è¢«â€œå®šæ ¼â€ã€‚å½“ React æœ€ç»ˆå¼€å§‹å¤„ç†é˜Ÿåˆ—æ—¶ï¼Œå®ƒä¼š**æŒ‰é¡ºåº**å–å‡ºè¿™äº›æŒ‡ä»¤å¹¶æ‰§è¡Œã€‚æ¯”å¦‚è¿ç»­ä¸¤æ¬¡ `this.setState(prev => ({ num: prev.num + 1 }))` æ‰§è¡Œæ—¶:

- **å¤„ç†ç¬¬ä¸€æ¡æŒ‡ä»¤ï¼š** React è·å–å½“å‰æœ€æ–°çš„çŠ¶æ€ï¼ˆ`count` ä¸º `0`ï¼‰ï¼Œå°† `0` ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œå¾—åˆ° `0 + 1`ï¼Œç»“æœä¸º `1`ã€‚
- **å¤„ç†ç¬¬äºŒæ¡æŒ‡ä»¤ï¼š** React ä¼šè·å–**æ­¤æ—¶æ­¤åˆ»**æœ€æ–°çš„çŠ¶æ€ï¼ˆ`count` å·²ç»å˜æˆ `1`ï¼‰ï¼Œå°† `1` ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œå¾—åˆ° `1 + 1`ï¼Œç»“æœä¸º `2`ã€‚

`setState` å‡½æ•°å¼æ›´æ–°çš„ç²¾å¦™ä¹‹å¤„åœ¨äºï¼Œå®ƒè®©ä½ çš„æ›´æ–°é€»è¾‘ä¸æ‰§è¡Œæ—¶æœºçš„â€œæ—¶ç©ºâ€å¯¹é½äº†ã€‚å®ƒä¸åƒç›´æ¥ä¼ å…¥å±æ€§é‚£æ ·å›ºåŒ–äº†æ—§å€¼ï¼Œè€Œæ˜¯å§‹ç»ˆèƒ½å¤Ÿè·å–åˆ°æœ€å³æ—¶çš„çŠ¶æ€ï¼Œç¡®ä¿äº†é“¾å¼æ›´æ–°çš„**æ­£ç¡®æ€§**å’Œ**é¡ºåºæ€§**ã€‚

#### å®é™…æ•°æ®ä¸å¿ƒæ™ºä¸åŒé—®é¢˜

`useState`ä½¿ç”¨ä¸å¥½å¯èƒ½å› ä¸ºä»–çš„æ‰¹é‡å¼‚æ­¥ç‰¹æ€§è€Œé€ æˆä¸å¿ƒæ™ºä¸ç¬¦ï¼Œå‡ºç°`setState`åæ‰§è¡Œä»ç„¶æ˜¯`null`çš„ bugã€‚æˆ‘å·²ç»å‡ºè¿‡ä¸¤æ¬¡è¿™é‡Œçš„é—®é¢˜äº† ğŸ¥²

å¯å‚è€ƒ[å®˜ç½‘ FAQ](https://zh-hans.react.dev/reference/react/useState#ive-updated-the-state-but-logging-gives-me-the-old-value)

```jsx
function handleClick() {
  console.log(count); // 0

  setCount(count + 1); // è¯·æ±‚ä½¿ç”¨ 1 é‡æ–°æ¸²æŸ“
  console.log(count); // ä»ç„¶æ˜¯ 0!

  setTimeout(() => {
    console.log(count); // è¿˜æ˜¯ 0!
  }, 5000);
  // è§£å†³æ–¹æ³•
  const nextCount = count + 1;
  setCount(nextCount);
  console.log(count); // 0
  console.log(nextCount); // 1
}
```

### **useEffect**

å‰¯ä½œç”¨ `effect` å‡½æ•°æ˜¯åœ¨æ¸²æŸ“ä¹‹å¤–é¢å¤–æ‰§è¡Œçš„ä¸€äº›é€»è¾‘ã€‚å®ƒæ˜¯æ ¹æ®ç¬¬äºŒä¸ªå‚æ•°çš„ä¾èµ–æ•°ç»„æ˜¯å¦å˜åŒ–æ¥å†³å®šæ˜¯å¦æ‰§è¡Œ effectï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œä¼šåœ¨ä¸‹æ¬¡ effect æ‰§è¡Œå‰æ‰§è¡Œã€‚

å…·ä½“å¯æŸ¥é˜…[å®˜æ–¹æ–‡æ¡£](https://zh-hans.react.dev/reference/react/useEffect)

### **useLayoutEffect**

å’Œ`useEffect`ä½¿ç”¨æ–¹æ³•(å‚æ•°)ä¸€è‡´ï¼Œåœºæ™¯ä¹Ÿéå¸¸ç›¸åƒï¼Œä¸‹è¾¹ä¸»è¦è®²ä¸¤è€…åŒºåˆ«

**ä¸¤è€…å·®åˆ«**

`useEffect`æ˜¯åœ¨é¡µé¢æ¸²æŸ“åå†æ‰§è¡Œ, åè€…åœ¨ dom æ¸²æŸ“åç«‹å³æ‰§è¡Œï¼Œç„¶åå†è¿›è¡Œé¡µé¢ç»˜åˆ¶ã€‚å®é™…ä¸Šï¼Œ`useLayoutEffect`ç›¸å½“äºæ¯æ¬¡ä¼šåœ¨å¯¹åº”ç±»ç»„ä»¶`componentDidMount`çš„
é˜¶æ®µæ‰§è¡Œï¼Œè€Œ`useEffect`åœ¨æºç ä¸­æ˜¯ç›¸å½“äºä¼šåœ¨ `commit`é˜¶æ®µ å®Œæˆåï¼Œé€šè¿‡ `Scheduler` æ¨¡å—æˆ–æµè§ˆå™¨çš„ `MessageChannel` å®‰æ’ä¸€ä¸ªå¼‚æ­¥å›è°ƒï¼Œ
æŠŠ useEffect çš„é€»è¾‘æ”¾è¿›å»ç­‰å¾…æ‰§è¡Œã€‚

```shell
render â†’ commit â†’ paint â†’ effect
render â†’ commit â†’ effect â†’ paint
```

### **useReducer**

å°è£…ä¸€äº›ä¿®æ”¹çŠ¶æ€çš„é€»è¾‘åˆ° reducerï¼Œé€šè¿‡ action è§¦å‘ï¼Œç›¸è¾ƒäº `useState` æ›´é€‚åˆåœ¨é€»è¾‘å¤æ‚çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚å½“ä¿®æ”¹æ·±å±‚å¯¹è±¡çš„æ—¶å€™ï¼Œåˆ›å»ºæ–°å¯¹è±¡æ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥ç»“åˆ `immer`

### **useRef**

useRef åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„â€œç›’å­â€ï¼Œè¿™ä¸ªç›’å­æœ¬èº«ï¼ˆå³ä½ ç”¨ const myRef = useRef(...) å£°æ˜çš„å˜é‡ï¼‰åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­æ˜¯æ’å®šä¸å˜çš„ã€‚è¿™ä¸ªç›’å­æœ‰ä¸€ä¸ªå”¯ä¸€çš„å±æ€§ï¼Œå« `current`ã€‚

å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªä¸å— React å½±å“çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ª current å±æ€§å¯ä»¥è¢«èµ‹å€¼æ”¹å˜ï¼Œé€‚åˆ

### **forwardRef + useImperativeHandle**

é€šè¿‡ forwardRef å¯ä»¥ä»å­ç»„ä»¶è½¬å‘ `ref` åˆ°çˆ¶ç»„ä»¶ï¼Œå¦‚æœæƒ³è‡ªå®šä¹‰ ref å†…å®¹å¯ä»¥ä½¿ç”¨ useImperativeHandle

### **useContext**

è·¨å±‚ç»„ä»¶ä¹‹é—´ä¼ é€’æ•°æ®å¯ä»¥ç”¨ Contextã€‚ç”¨ createContext åˆ›å»º context å¯¹è±¡ï¼Œç”¨ Provider ä¿®æ”¹å…¶ä¸­çš„å€¼ï¼Œ function ç»„ä»¶ä½¿ç”¨ useContext çš„ hook æ¥å–å€¼ï¼Œclass ç»„ä»¶ä½¿ç”¨ Consumer æ¥å–å€¼

### **React.memo + useMemo + useCallback**

memo åŒ…è£¹çš„ç»„ä»¶åªæœ‰åœ¨ props å˜(æµ…æ¯”è¾ƒ)çš„æ—¶å€™æ‰ä¼šé‡æ–°æ¸²æŸ“ï¼Œ`useMemo`ã€`useCallback` å¯¹ç»„ä»¶ä¸­é«˜è®¡ç®—æ€§çš„å†…å®¹åŸºäº`props`ä¸å˜æ—¶è¿›è¡Œç¼“å­˜ï¼ŒåŒºåˆ«åœ¨äº memo ç¼“å­˜æ™®é€šå±æ€§æˆ–å‡½æ•°æ‰§è¡Œç»“æœï¼Œ`callback` ç¼“å­˜å‡½æ•°å¼•ç”¨(æœ¬è´¨ä¸Š useCallback åªæ˜¯åœ¨ç¼“å­˜å‡½æ•°åœºæ™¯ä¸‹ useMemo çš„è¯­æ³•ç³–)

```javascript
// ç¼“å­˜å‡½æ•°
useCallback(fn, deps); // better
useMemo(() => fn, deps);
```
