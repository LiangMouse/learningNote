# BFC (块级格式上下文) 完全指南

BFC（Block Formatting Context），即“块级格式上下文”，是 Web 页面 CSS 视觉渲染的一部分。它是一个独立的渲染区域，规定了内部的块级盒子如何布局，并且这个区域的内部布局与外部互不影响。

可以把 BFC 理解为一个独立的“箱子”，箱子里的元素无论如何摆放，都不会影响到箱子外的元素。反之，箱子外的布局也不会影响箱子内的元素。

## BFC 的特性

一个 BFC 区域具有以下几个关键特性：

1.  **内部的 Box 会在垂直方向，一个接一个地放置。**
2.  **Box 垂直方向的距离由`margin`决定。属于同一个 BFC 的两个相邻 Box 的`margin`会发生折叠。**
3.  **BFC 的区域不会与`float` box 重叠。**
4.  **BFC 就是页面上的一个隔离的独立容器，容器里面的子元素不会影响到外面的元素。**
5.  **计算 BFC 的高度时，浮动元素也参与计算。**

## 如何触发 BFC

要创建一个 BFC，可以满足以下任意一个条件：

- **根元素** (`<html>`)
- **浮动元素**：`float` 的值不为 `none`。
- **绝对定位元素**：`position` 的值为 `absolute` 或 `fixed`。
- **行内块元素**：`display` 的值为 `inline-block`。
- **表格单元格**：`display` 的值为 `table-cell` 或 `table-caption`。
- **弹性元素或网格元素**：`display` 的值为 `flex` 或 `grid` 的直接子元素。
- **`overflow` 的值不为 `visible`**：如 `hidden`、`auto`、`scroll`。
- **`display: flow-root;`**：这是最推荐的方式，它可以创建一个无任何副作用的 BFC。

## BFC 的应用场景

理解了 BFC 的特性后，我们就可以利用它来解决 CSS 布局中一些常见的问题。

### 1. 防止外边距折叠

**问题描述**：在标准文档流中，两个相邻的块级盒子的垂直外边距会发生“折叠”，最终的间距取两者中的较大值。

**解决方案**：将其中一个盒子放入一个 BFC 容器中，因为不同 BFC 之间的 `margin` 不会折叠。

**示例代码**：

```html
<style>
  .box {
    width: 100px;
    height: 100px;
    background: lightblue;
    margin: 30px;
  }
  .bfc-container {
    overflow: hidden; /* 创建 BFC */
  }
</style>

<!-- 折叠前 -->
<div class="box"></div>
<div class="box"></div>

<!-- 解决后 -->
<div class="box"></div>
<div class="bfc-container">
  <div class="box"></div>
</div>
```

在解决后的例子中，第二个盒子被包裹在了一个创建了 BFC 的容器里，因此它与第一个盒子的 `margin` 不再折叠，总间距为 `30px + 30px = 60px`。

### 2. 清除浮动（解决高度塌陷）

**问题描述**：当父元素没有设置高度时，如果其内部的子元素全部浮动，父元素将无法包裹浮动元素，导致“高度塌陷”。

**解决方案**：将父元素触发为 BFC。因为 BFC 在计算高度时，会把浮动子元素也计算在内。

**示例代码**：

```html
<style>
  .parent {
    border: 2px solid #f00;
    /* 解决方法：添加下面这行代码，触发 BFC */
    /* overflow: hidden; */
  }
  .child {
    width: 100px;
    height: 100px;
    background: lightgreen;
    float: left;
  }
</style>

<div class="parent">
  <div class="child"></div>
</div>
```

当把 `.parent` 的 `overflow: hidden` 注释打开后，`.parent` 就创建了一个 BFC，它的高度会自动包含浮动的子元素，边框也就能正常包裹子元素了。

### 3. 防止元素被浮动元素覆盖

**问题描述**：一个块级元素会忽略浮动元素的位置，导致其内容被浮动元素覆盖，但其内部的文本内容会环绕浮动元素。

**解决方案**：将这个块级元素触发为 BFC，因为它不会与浮动元素的区域重叠。

**示例代码**：

```html
<style>
  .float-box {
    width: 150px;
    height: 150px;
    background: lightcoral;
    float: left;
  }
  .normal-box {
    height: 200px;
    background: lightslategray;
    /* 解决方法：添加下面这行代码，触发 BFC */
    /* overflow: hidden; */
  }
</style>

<div class="float-box"></div>
<div class="normal-box">我是一些不会环绕的文字内容。</div>
```

当把 `.normal-box` 的 `overflow: hidden` 注释打开后，它就创建了一个 BFC。根据“BFC 的区域不会与 `float` box 重叠”的特性，`.normal-box` 会自动调整自己的宽度和位置，不再被浮动元素覆盖。
