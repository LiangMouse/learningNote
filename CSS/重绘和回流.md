# 重绘和回流

## 什么是重绘和回流？

在浏览器渲染页面的过程中，重绘（Repaint）和回流（Reflow）是两个重要的概念：

- **重绘**：当元素的外观发生变化（例如颜色、背景等），但不影响布局时，浏览器会重新绘制这些元素。
- **回流**：又叫重排。当元素的几何属性（例如宽度、高度、位置等）发生变化时，浏览器需要重新计算布局，并重新渲染受影响的部分。

简单来说，回流一定会引发重绘，而重绘不一定会引发回流。

## 什么会触发重绘和回流？

### 触发重绘的常见操作：

- 改变元素的颜色、背景、边框颜色等。
- 修改文字颜色或阴影。

### 触发回流的常见操作：

- 添加或删除 DOM 元素。
- 改变元素的尺寸（宽度、高度、内边距、边框等）。
- 改变元素的位置（例如 `position` 属性）。
- 改变字体大小。
- 设置 `display` 为 `none` 或从 `none` 改为其他值。
- 滚动页面。

## 性能影响

回流的性能开销比重绘大得多，因为它需要重新计算布局并重新渲染页面。尤其是在复杂的页面中，频繁触发回流可能会导致明显的性能问题。

浏览器会对回流进行优化，例如批量处理多次操作，但我们仍然需要尽量减少不必要的回流。

## 如何优化？

### 1. 减少 DOM 操作

- 合并多次 DOM 操作，避免频繁修改。
- 使用文档片段（DocumentFragment）批量插入元素。

### 2. 避免频繁读取和写入

- 避免在循环中频繁读取和修改 DOM 属性。
- 使用变量缓存需要多次访问的值。

### 3. 使用 CSS 优化

- 使用 `transform` 和 `opacity` 替代会触发回流的属性（例如 `top`、`left`）。
- 使用 `will-change` 提示浏览器优化。

### 4. 避免触发同步布局

- 避免频繁调用会触发同步布局的方法，例如 `offsetWidth`、`offsetHeight`、`getComputedStyle` 等。

### 5. documentFragemnt

原生的虚拟 dom 集合，用于批量操作 dom，避免回流

---

希望这篇文章能让你对重绘和回流有更深入的理解！😉
