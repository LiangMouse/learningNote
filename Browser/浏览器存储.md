# 浏览器本地存储

## Cookie

背景:HTTP 是无状态协议，但 Web 应用需要保持状态
服务端产生内容，发送浏览器并保存本地
每次浏览器向同一服务器发送请求时，都会将 Cookie 发送回服务器
因为来回传递，一般用于保持会话状态，身份验证和跟踪用户的行为(根据访问偏好推送广告的"偏好"就保留在这里)

```javascript
document.cookie = `${name}=${value}; Max-Age=${expire}`;
```

#### 优点

- 在浏览器和服务器间来回传递适用于跟踪用户行为
- 可以手动设置过期时间，灵活调节存储时间

#### 缺点

- 每次请求都会携带`Cookie`数据，增加流量浪费性能
- 在`HTTP`中明文传输安全性差
- 存储容量小，一般为`4kb`

## LocalStorage

解决`Cookie`可用内存小，流量消耗大的问题。`HTML5`引入了`Local Storage`,是一个 API，允许在浏览器中长期存储键值对数据，不会随着 HTTP 请求发送至服务器
可以用`localStorage`来保存浏览器中用户的偏好设置，隐私等选项
不同于`Cookie`手动设置存储有效期，`LocalStorage`永久有效

#### 优点

- 存储容量较大，一般为`5M`
- 存储的数据在客户端浏览器中可以永久保存，不担心丢失
- 操作方便，API 友好，能通过 JavaScript 直接访问

#### 缺点

- 受同源策略限制，一个网站只能访问自己域下的 LocalStorage,虽然是安全特性，但对跨域数据共享和单点登录等功能有限制
- 不能在不同浏览器间共享

## Session Stroage

与`localStorage类似`，最大区别在于数据仅在浏览器会话期间有效，关闭对应浏览器标签窗口，会清除对应的`Session Storage`

应用场景： 一个多步骤表单，用户在填写过程点击上一步/下一步来修改数据，可以使用`Session Storage`暂存

#### 优点

- 数据只存储在客户端
- 刷新页面仍有原会话数据
- 每个标签间的数据独立

#### 缺点

- 关闭标签就会清楚，不适合长期存储
- 不同浏览器不同 tab 间不会共享数据，因此应用场景优先

## 总结

- 这三种都保存在浏览器端，不建议存储敏感信息
- 不支持跨域，在跨域场景需要考虑其他解决方案

### 三者对比总结

| 特性           | Cookie                                       | Local Storage                        | Session Storage                        |
| -------------- | -------------------------------------------- | ------------------------------------ | -------------------------------------- |
| 存储大小       | 一般限制在 4KB 左右                          | 通常为 5MB（不同浏览器可能不同）     | 通常为 5MB（不同浏览器可能不同）       |
| 生命周期       | 由 `expires` 或 `max-age` 控制，可以持久化   | 持久存储，除非手动删除，否则不会过期 | 仅在页面会话期间存在，关闭标签页即清除 |
| 作用域         | 同域下的所有页面共享                         | 同源下的所有页面共享                 | 仅在同一标签页和窗口中可用             |
| 与服务器的交互 | 每次请求时会自动携带在请求头中               | 不随请求发送，只在客户端使用         | 不随请求发送，只在客户端使用           |
| 读写方式       | 通过 `document.cookie` 读写，较繁琐          | 通过 `localStorage` API 简单读写     | 通过 `sessionStorage` API 简单读写     |
| 安全性         | 可设置 `HttpOnly` 和 `Secure` 属性提高安全性 | 无法直接设置 `HttpOnly` 或 `Secure`  | 无法直接设置 `HttpOnly` 或 `Secure`    |
| 常用场景       | 会话管理（如用户登录状态）、追踪用户行为     | 长期保存用户偏好或数据缓存           | 单次会话的数据保存，如表单临时数据     |

此外还有像`GET`缓存，存储在浏览器的 内存缓存 或 磁盘缓存 中，主要由浏览器的缓存机制（包括 HTTP 头信息控制）来管理。
